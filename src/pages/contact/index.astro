---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Nav from '../../components/Nav.astro';
import Footer from '../../components/Footer.astro';
import '../../styles/global.css';

const title = 'Contact — Lindahl Studios';
const description = 'Get in touch about your Shopify project. Custom development, CRO-focused UI/UX, and ecommerce strategy.';
---

<BaseLayout title={title} description={description}>
  <Nav />
  <main id="content" class="bg-cream min-h-[80vh]">
    <div class="max-w-site mx-auto px-6 md:px-12 py-16 md:py-24">
      <div class="max-w-xl">
        <h1
          class="font-serif text-4xl md:text-[44px] leading-[1.1] mb-6"
          data-sal="fade-up"
          data-sal-duration="500"
        >
          Let's talk about your project.
        </h1>

        <p
          class="text-[17px] leading-[1.78] text-gray-600 mb-10"
          data-sal="fade-up"
          data-sal-duration="500"
          data-sal-delay="100"
        >
          Fill out the form below with some details about your project. I'll get
          back to you within one business day.
        </p>

        <form
          name="contact"
          method="POST"
          data-netlify="true"
          netlify-honeypot="bot-field"
          action="/contact/success"
          class="space-y-6"
          data-sal="fade-up"
          data-sal-duration="500"
          data-sal-delay="200"
          x-data="contactForm"
          x-on:submit.prevent="submit()"
          novalidate
        >
          <!-- Required for Netlify to identify the form on JS-submitted POSTs -->
          <input type="hidden" name="form-name" value="contact" />
          <!-- Hidden inputs for project type and scope -->
          <input type="hidden" name="project_type" x-bind:value="projectType" />
          <input type="hidden" name="scope" x-bind:value="scope" />
          <!-- Honeypot for spam -->
          <p class="hidden">
            <label>Don't fill this out: <input name="bot-field" /></label>
          </p>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="name" class="block text-sm font-medium text-charcoal mb-2">
                Name
              </label>
              <input
                type="text"
                id="name"
                name="name"
                required
                x-model="name"
                :class="errors.name ? 'border-red-500' : 'border-gray-300'"
                class="w-full px-4 py-3 rounded-lg border bg-white text-charcoal text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-forest/20 focus:border-forest transition-colors"
                placeholder="Your name"
              />
              <p x-show="errors.name" x-text="errors.name" class="text-red-600 text-xs mt-1.5" role="alert" style="display:none"></p>
            </div>

            <div>
              <label for="email" class="block text-sm font-medium text-charcoal mb-2">
                Email
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                x-model="email"
                :class="errors.email ? 'border-red-500' : 'border-gray-300'"
                class="w-full px-4 py-3 rounded-lg border bg-white text-charcoal text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-forest/20 focus:border-forest transition-colors"
                placeholder="you@company.com"
              />
              <p x-show="errors.email" x-text="errors.email" class="text-red-600 text-xs mt-1.5" role="alert" style="display:none"></p>
            </div>
          </div>

          <!-- Project Type -->
          <div>
            <label class="block text-sm font-medium text-charcoal mb-2">Project Type</label>
            <div class="grid grid-cols-3 gap-3">
              <button
                type="button"
                @click="projectType = 'one-off'; scope = ''"
                :class="projectType === 'one-off' ? 'border-forest bg-forest text-white' : 'border-gray-200 bg-white text-gray-600 hover:border-gray-300'"
                class="px-4 py-3 rounded-lg border text-sm font-medium transition-colors text-left"
              >
                One-off project
              </button>
              <button
                type="button"
                @click="projectType = 'retainer'; scope = ''"
                :class="projectType === 'retainer' ? 'border-forest bg-forest text-white' : 'border-gray-200 bg-white text-gray-600 hover:border-gray-300'"
                class="px-4 py-3 rounded-lg border text-sm font-medium transition-colors text-left"
              >
                Ongoing retainer
              </button>
              <button
                type="button"
                @click="projectType = 'other'; scope = ''"
                :class="projectType === 'other' ? 'border-forest bg-forest text-white' : 'border-gray-200 bg-white text-gray-600 hover:border-gray-300'"
                class="px-4 py-3 rounded-lg border text-sm font-medium transition-colors text-left"
              >
                Other
              </button>
            </div>
          </div>

          <!-- Scope (one-off only) -->
          <div x-show="projectType === 'one-off'" x-transition style="display:none">
            <label class="block text-sm font-medium text-charcoal mb-2">Scope</label>
            <div class="grid grid-cols-2 gap-3">
              <button
                type="button"
                @click="scope = 'fresh-build'"
                :class="scope === 'fresh-build' ? 'border-forest bg-forest text-white' : 'border-gray-200 bg-white text-gray-600 hover:border-gray-300'"
                class="px-4 py-3 rounded-lg border text-sm font-medium transition-colors text-left"
              >
                Fresh build
              </button>
              <button
                type="button"
                @click="scope = 'maintenance'"
                :class="scope === 'maintenance' ? 'border-forest bg-forest text-white' : 'border-gray-200 bg-white text-gray-600 hover:border-gray-300'"
                class="px-4 py-3 rounded-lg border text-sm font-medium transition-colors text-left"
              >
                Maintenance & improvements
              </button>
            </div>
            <p
              x-show="scope"
              x-text="scope === 'fresh-build' ? 'Fresh builds start at $5,000.' : 'Maintenance projects start at $1,000.'"
              class="text-xs text-gray-400 mt-2"
              style="display:none"
            ></p>
          </div>

          <div>
            <label for="shopify-url" class="block text-sm font-medium text-charcoal mb-2">
              Shopify Store URL <span class="text-gray-400 font-normal">(if applicable)</span>
            </label>
            <input
              type="url"
              id="shopify-url"
              name="shopify_url"
              class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white text-charcoal text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-forest/20 focus:border-forest transition-colors"
              placeholder="https://yourstore.myshopify.com"
            />
          </div>

          <div>
            <label for="budget" class="block text-sm font-medium text-charcoal mb-2">
              Budget Range
            </label>
            <select
              id="budget"
              name="budget"
              class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white text-charcoal text-sm focus:outline-none focus:ring-2 focus:ring-forest/20 focus:border-forest transition-colors"
            >
              <option value="" disabled selected>Select a range</option>
              <option value="under-5k">Under $5,000</option>
              <option value="5k-10k">$5,000 – $10,000</option>
              <option value="10k-20k">$10,000 – $20,000</option>
              <option value="20k-plus">$20,000+</option>
              <option value="retainer">Ongoing retainer</option>
              <option value="not-sure">Not sure yet</option>
            </select>
          </div>

          <div>
            <label for="timeframe" class="block text-sm font-medium text-charcoal mb-2">
              Target Timeframe <span class="text-gray-400 font-normal">(optional)</span>
            </label>
            <select
              id="timeframe"
              name="timeframe"
              class="w-full px-4 py-3 rounded-lg border border-gray-300 bg-white text-charcoal text-sm focus:outline-none focus:ring-2 focus:ring-forest/20 focus:border-forest transition-colors"
            >
              <option value="" selected>Not sure yet</option>
              <option value="asap">ASAP</option>
              <option value="1-2-months">1–2 months</option>
              <option value="3-6-months">3–6 months</option>
              <option value="flexible">Flexible</option>
            </select>
          </div>

          <div>
            <label for="message" class="block text-sm font-medium text-charcoal mb-2">
              Project Details
            </label>
            <textarea
              id="message"
              name="message"
              rows="5"
              required
              x-model="message"
              :class="errors.message ? 'border-red-500' : 'border-gray-300'"
              class="w-full px-4 py-3 rounded-lg border bg-white text-charcoal text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-forest/20 focus:border-forest transition-colors resize-y"
              placeholder="Tell me about your project — what you're looking to build, goals, timeline, etc."
            ></textarea>
            <p x-show="errors.message" x-text="errors.message" class="text-red-600 text-xs mt-1.5" role="alert" style="display:none"></p>
          </div>

          <button
            type="submit"
            class="inline-block px-8 py-3.5 bg-forest text-white rounded-lg text-[15px] font-semibold hover:bg-forest-light transition-colors"
          >
            Send Message →
          </button>
        </form>
      </div>
    </div>
  </main>
  <Footer />
</BaseLayout>

<script>
  import Alpine from 'alpinejs';

  Alpine.data('contactForm', () => ({
    name: '',
    email: '',
    message: '',
    projectType: '',
    scope: '',
    errors: {} as Record<string, string>,

    validate() {
      this.errors = {};

      if (!this.name.trim()) {
        this.errors.name = 'Please enter your name.';
      }

      if (!this.email.trim()) {
        this.errors.email = 'Please enter your email address.';
      } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email.trim())) {
        this.errors.email = 'Please enter a valid email address.';
      }

      if (!this.message.trim()) {
        this.errors.message = 'Please tell me about your project.';
      }

      return Object.keys(this.errors).length === 0;
    },

    submit() {
      if (this.validate()) {
        (this.$el as HTMLFormElement).submit();
      } else {
        // Scroll first error into view on mobile
        this.$nextTick(() => {
          this.$el.querySelector('[role="alert"]')
            ?.previousElementSibling
            ?.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
      }
    },
  }));

  window.Alpine = Alpine;
  Alpine.start();
</script>
